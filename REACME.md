# â›©ï¸ åˆ†æ•£ãŠã¿ãã˜API - `jinjya-api`

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**è¤‡æ•°ã®ç¥ç¤¾ï¼ˆç®¡ç†è€…ï¼‰ãŒãŠã¿ãã˜ã‚’åˆ†æ•£ç®¡ç†**ã§ãã‚‹APIã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ `/api/draw` ã§ãŠã¿ãã˜ã‚’å–å¾—ã—ã€ `/api/submit` ã§çµæœã‚’æŠ•ç¨¿ã€å®šæœŸçš„ã« `/api/publish` ã«ã‚ˆã‚Šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸é€ä¿¡ã•ã‚Œã¾ã™ã€‚

**ç¥ç¤¾å´ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæä¾›è€…ï¼‰ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã®å½¹å‰²ãŒåˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚**

---

## ğŸ§™â€â™‚ï¸ ç¥ç¤¾ã‚’å»ºã¦ãŸã„äººå‘ã‘ï¼ˆç®¡ç†è€…ï¼‰

### 1. Google Sheets ã‚’æº–å‚™

ä»¥ä¸‹ã®åˆ—ã‚’ç”¨æ„ã—ãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

```
timestamp | jinjya | fortune | message | tags | extra
```

- `tags`ï¼š{"æ‹æ„›":"è‰¯ã—","é‡‘é‹":"æ™®é€š",...} ã®ã‚ˆã†ãªã‚«ãƒ†ã‚´ãƒªã”ã¨ã®çµæœ
- `extra`ï¼š{"LuckyColor":"é’","Animal":"ç‹"} ã®ã‚ˆã†ãªè¿½åŠ æƒ…å ±

### 2. GAS ã‚’è¨­å®š

Google Apps Script ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ï¼š

```js
function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("omikuji");
  const data = JSON.parse(e.postData.contents);
  const rows = Array.isArray(data) ? data : [data];

  rows.forEach(entry => {
    sheet.appendRow([
      entry.timestamp || new Date().toISOString(),
      entry.jinjya || "",
      entry.fortune || "",
      entry.message || "",
      JSON.stringify(entry.tags || {}),
      JSON.stringify(entry.extra || {})
    ]);
  });

  return ContentService.createTextOutput("OK").setMimeType(ContentService.MimeType.TEXT);
}
```

**â†’ ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã¨ã—ã¦å…¬é–‹ã—ã€POSTå¯èƒ½ãªURLã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚**

### 3. API ã«ç™»éŒ²ï¼ˆç¥ç¤¾IDã¯ä¸€æ„ï¼‰

```bash
curl -X POST https://jinjya-api.eightman124.workers.dev/api/jinjya/register \
  -H "Content-Type: application/json" \
  -d '{
    "id": "furin",
    "name": "é¢¨éˆ´ç¥ç¤¾",
    "spreadsheet_url": "https://script.googleusercontent.com/...",
    "owner": "your-name-or-identifier"
  }'
```

---

## ğŸ‘¤ ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå‚æ‹è€…ï¼‰

### ãŠã¿ãã˜ã‚’å¼•ãï¼ˆGETï¼‰

```bash
curl https://jinjya-api.eightman124.workers.dev/api/draw
```

### çµæœã‚’æå‡ºã™ã‚‹ï¼ˆPOSTï¼‰

```bash
curl -X POST https://jinjya-api.eightman124.workers.dev/api/submit \
  -H "Content-Type: application/json" \
  -d '{
    "jinjya": "furin",
    "fortune": "ä¸­å‰",
    "message": "ä½•äº‹ã‚‚æˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™",
    "tags": {
      "æ‹æ„›": "ç©ã‚„ã‹",
      "ä»•äº‹": "æ³¨æ„æ·±ã",
      "å¥åº·": "è‰¯å¥½",
      "é‡‘é‹": "ã¡ã‚‡ã£ã¨ç„¡é§„é£ã„",
      "å­¦æ¥­": "ã‚³ãƒ„ã‚³ãƒ„ã‚„ã‚‹ã¹ã—"
    },
    "extra": {
      "ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼": "é’",
      "ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ãƒ‹ãƒãƒ«": "ç‹",
      "é–‹é‹æ–¹ä½": "å—æ±"
    }
  }'
```

---

## ğŸ§¾ ç®¡ç†APIä¸€è¦§

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | æ¦‚è¦ |
|----------------|------|
| `GET  /api/draw` | ãŠã¿ãã˜ã‚’å¼•ã |
| `POST /api/submit` | çµæœã‚’é€ä¿¡ |
| `POST /api/publish` | ãƒãƒƒãƒ•ã‚¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å„ç¥ç¤¾ã®GASã¸é€ä¿¡ |
| `GET  /api/jinjya/list` | ç™»éŒ²æ¸ˆã¿ç¥ç¤¾ä¸€è¦§ |
| `POST /api/jinjya/register` | ç¥ç¤¾ã‚’ç™»éŒ²ï¼ˆGAS URLãªã©ï¼‰|

---

## ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ†ãƒ³ãƒ—ãƒ¬

**APIé€ä¿¡ãƒ‡ãƒ¼ã‚¿å½¢å¼**:
```json
{
  "jinjya": "furin",
  "fortune": "å¤§å‰",
  "message": "ä»Šæ—¥ã¯æœ€é«˜ã®æ—¥ã§ã™ã€‚",
  "tags": {
    "æ‹æ„›": "é‹å‘½çš„ãªå‡ºä¼šã„ã‚ã‚Š",
    "ä»•äº‹": "å¤§æˆåŠŸ",
    "å¥åº·": "çµ¶å¥½èª¿",
    "é‡‘é‹": "è‡¨æ™‚åå…¥",
    "å­¦æ¥­": "ç†è§£åŠ›å‘ä¸Š"
  },
  "extra": {
    "ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼": "é‡‘",
    "ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ãƒ‹ãƒãƒ«": "çŒ«",
    "é–‹é‹æ–¹ä½": "æ±å—",
    "ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼": "7"
  }
}
```

**Google Sheetsä¿å­˜å½¢å¼**:
```json
{
  "timestamp": "2025-08-03T12:00:00Z",
  "jinjya": "furin",
  "fortune": "å¤§å‰",
  "message": "ä»Šæ—¥ã¯æœ€é«˜ã®æ—¥ã§ã™ã€‚",
  "tags": "{\"æ‹æ„›\":\"é‹å‘½çš„ãªå‡ºä¼šã„ã‚ã‚Š\",\"å¥åº·\":\"çµ¶å¥½èª¿\"}",
  "extra": "{\"ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼\":\"é‡‘\",\"ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ãƒ‹ãƒãƒ«\":\"çŒ«\"}"
}
```

---

## ğŸ›¡ï¸ å®‰å…¨è¨­è¨ˆ

- ãƒ‡ãƒ¼ã‚¿ã¯ç¥ç¤¾ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ï¼‰ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã—ã‹é€ä¿¡ã•ã‚Œã¾ã›ã‚“
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ä»»æ„ã®ç¥ç¤¾ã«é€ä¿¡å¯èƒ½ã§ã™ãŒã€**GASå´ã®èªè¨¼ã«ã‚ˆã‚Šä¸æ­£æŠ•ç¨¿ã¯ãƒ–ãƒ­ãƒƒã‚¯ã§ãã¾ã™**
- æœ¬APIå´ã§ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰ã®**å€‹äººæƒ…å ±ã‚’ä¿æŒã—ã¾ã›ã‚“**

---

## ğŸ’¡ ä»Šå¾Œã®ã‚¢ã‚¤ãƒ‡ã‚¢ï¼ˆäºˆå®šï¼‰

- Google / GitHub OAuth ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼
- ãŠã¿ãã˜ã®ç¨®é¡ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆæ‹æ„›ç‰¹åŒ–ã€æˆ¦å›½æ­¦å°†é¢¨ã€ä¼æ¥­å‘ã‘ãªã©ï¼‰
- æŠ•ç¨¿æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»äººæ°—ç¥ç¤¾è¡¨ç¤º
- ãŠã¿ãã˜ã®æ™‚é™å…¬é–‹ or å®šæœŸçš„ã«æ›´æ–°

---

## ğŸ“® é‹å–¶

- é–‹ç™ºè€…: [eightman](https://github.com/eightman999)
- ãƒ‰ãƒ¡ã‚¤ãƒ³: `bakasekai.net`ï¼ˆCloudflare Workers / Pagesã§é‹ç”¨ï¼‰
